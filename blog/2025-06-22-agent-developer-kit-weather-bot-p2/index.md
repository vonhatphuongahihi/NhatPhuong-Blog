---
slug: agent-development-kit-weather-bot-p2
title: "X√¢y D·ª±ng H·ªá Th·ªëng ƒêa Agent Th√¥ng Minh v·ªõi Google ADK: Weather Bot ƒêa T√°c Nh√¢n (P2)"
image: img/agent-development-kit-beginner.png
authors: [vonhatphuong]
tags: [ADK, LLM, AIagent]
---

# X√¢y D·ª±ng H·ªá Th·ªëng ƒêa Agent Th√¥ng Minh v·ªõi Google ADK: Weather Bot ƒêa T√°c Nh√¢n (P2)

üå§Ô∏è ·ªû blog P1, m√¨nh ƒë√£ x√¢y d·ª±ng m·ªôt Weather Agent ho·∫°t ƒë·ªông t·ªët v·ªõi m·ªôt model c·ª• th·ªÉ Gemini. Tuy nhi√™n, trong c√°c ·ª©ng d·ª•ng th·ª±c t·∫ø, vi·ªác s·ª≠ d·ª•ng nhi·ªÅu m√¥ h√¨nh LLM mang l·∫°i r·∫•t nhi·ªÅu l·ª£i √≠ch:
- **Hi·ªáu su·∫•t**: M·ªôt s·ªë m√¥ h√¨nh gi·ªèi v·ªÅ c√°c t√°c v·ª• c·ª• th·ªÉ (v√≠ d·ª•: vi·∫øt code, l·∫≠p lu·∫≠n logic, s√°ng t·∫°o)
- **Chi ph√≠**: Gi√° m·ªói m√¥ h√¨nh c√≥ th·ªÉ r·∫•t kh√°c nhau
- **Kh·∫£ nƒÉng**: M·ªói m√¥ h√¨nh c√≥ c√°c t√≠nh nƒÉng, k√≠ch th∆∞·ªõc ng·ªØ c·∫£nh, kh·∫£ nƒÉng fine-tune ri√™ng bi·ªát
- **T√≠nh s·∫µn s√†ng & D·ª± ph√≤ng**: N·∫øu m·ªôt nh√† cung c·∫•p g·∫∑p s·ª± c·ªë, v·∫´n c√≥ th·ªÉ d√πng m√¥ h√¨nh kh√°c ƒë·ªÉ duy tr√¨ h·ªá th·ªëng

## 2. Step 2: S·ª≠ d·ª•ng nhi·ªÅu m√¥ h√¨nh v·ªõi LiteLLM 
Trong b∆∞·ªõc n√†y, m√¨nh s·∫Ω h·ªçc c√°ch:
- C·∫•u h√¨nh m·ªôt Agent s·ª≠ d·ª•ng m√¥ h√¨nh t·ª´ c√°c nh√† cung c·∫•p nh∆∞ OpenAI (GPT) v√† Anthropic(Claude) th√¥ng qua wrapper LiteLLM
- T·∫°o v√† ki·ªÉm th·ª≠ nhi·ªÅu phi√™n b·∫£n Weather Agent, m·ªói phi√™n b·∫£n ch·∫°y tr√™n m·ªôt m√¥ h√¨nh kh√°c nhau (m·ªói c√°i c√≥ runner v√† session ri√™ng)
- T∆∞∆°ng t√°c v√† so s√°nh k·∫øt qu·∫£, ƒë·ªÉ xem ph·∫£n h·ªìi gi·ªØa c√°c m√¥ h√¨nh kh√°c nhau c√≥ g√¨ thay ƒë·ªïi, m·∫∑c d√π t·∫•t c·∫£ ƒë·ªÅu d√πng chung m·ªôt h√†m get_weather

**Import LiteLlm**
```
from google.adk.models.lite_llm import LiteLlm
```
LiteLLM l√† m·ªôt th∆∞ vi·ªán Python gi√∫p d·ªÖ d√†ng t√≠ch h·ª£p v√† s·ª≠ d·ª•ng nhi·ªÅu m√¥ h√¨nh ng√¥n ng·ªØ l·ªõn (LLMs) kh√°c nhau trong c√πng m·ªôt ·ª©ng d·ª•ng m√† kh√¥ng ph·∫£i lo v·ªÅ chi ti·∫øt t·ª´ng API ri√™ng bi√™t.

LiteLLM l√† c·∫ßu n·ªëi ƒëa m√¥ h√¨nh, h·ªó tr·ª£ g·ªçi c√°c LLM c·ªßa nhi·ªÅu nh√† cung c·∫•p nh∆∞ Google Gemini, OpenAI GPT, Anthropic Claude... qua m·ªôt giao di·ªán th·ªëng nh·∫•t v√† ƒë∆°n gi·∫£n.

**ƒê·ªãnh nghƒ©a v√† ki·ªÉm th·ª≠ c√°c Agent s·ª≠ d·ª•ng nhi·ªÅu m√¥ h√¨nh (Multi-Model)**

üîë Kh√°i ni·ªám ch√≠nh: **LiteLlm Wrapper**

C√∫ ph√°p LiteLlm(model="provider/model_name") cho ADK bi·∫øt r·∫±ng: M·ªçi y√™u c·∫ßu t·ª´ agent n√†y s·∫Ω ƒë∆∞·ª£c chuy·ªÉn qua th∆∞ vi·ªán LiteLLM, r·ªìi g·ª≠i ƒë·∫øn nh√† cung c·∫•p m√¥ h√¨nh t∆∞∆°ng ·ª©ng (v√≠ d·ª•: OpenAI, Anthropic).

Ta s·∫Ω d√πng l·∫°i h√†m ``call_agent_async`` (ƒë√£ ƒë·ªãnh nghƒ©a tr∆∞·ªõc), h√†m n√†y nh·∫≠n ``runner``, ``user_id`` v√† ``session_id`` ƒë·ªÉ t∆∞∆°ng t√°c v·ªõi agent sau khi setup.

M·ªói ƒëo·∫°n m√£ d∆∞·ªõi ƒë√¢y s·∫Ω th·ª±c hi·ªán:
1. ƒê·ªãnh nghƒ©a agent m·ªõi v·ªõi m·ªôt m√¥ h√¨nh LiteLLM c·ª• th·ªÉ (v√≠ d·ª•: ``MODEL_GPT_4O`` ho·∫∑c ``MODEL_CLAUDE_SONNET``)
2. T·∫°o m·ªõi m·ªôt ``InMemorySessionService`` v√† ``session`` ri√™ng cho agent ƒë√≥ gi√∫p l·ªãch s·ª≠ h·ªôi tho·∫°i kh√¥ng b·ªã tr·ªôn l·∫´n (ƒë·ªôc l·∫≠p)
3. T·∫°o runner cho t·ª´ng agent, d√πng session t∆∞∆°ng ·ª©ng
4. G·ªçi th·ª≠ ``call_agent_async`` ƒë·ªÉ g·ª≠i m·ªôt c√¢u h·ªèi v√† ki·ªÉm tra ph·∫£n h·ªìi t·ª´ agent

**T·∫°o v√† ki·ªÉm tra agent s·ª≠ d·ª•ng GPT-4o c·ªßa OpenAI**
```
# --- Agent d√πng GPT-4o ---
weather_agent_gpt = None  # Kh·ªüi t·∫°o bi·∫øn agent
runner_gpt = None         # Kh·ªüi t·∫°o bi·∫øn runner

try:
    weather_agent_gpt = Agent(
        name="weather_agent_gpt",
        # ƒêi·ªÉm kh√°c bi·ªát: D√πng model qua wrapper LiteLLM
        model=LiteLlm(model=MODEL_GPT_4O),
        description="Cung c·∫•p th√¥ng tin th·ªùi ti·∫øt (s·ª≠ d·ª•ng GPT-4o).",
        instruction="B·∫°n l√† m·ªôt tr·ª£ l√Ω th·ªùi ti·∫øt th√¢n thi·ªán, ƒë∆∞·ª£c h·ªó tr·ª£ b·ªüi GPT-4o. "
                    "H√£y d√πng c√¥ng c·ª• 'get_weather' ƒë·ªÉ x·ª≠ l√Ω c√°c y√™u c·∫ßu li√™n quan ƒë·∫øn th·ªùi ti·∫øt theo th√†nh ph·ªë. "
                    "Hi·ªÉn th·ªã k·∫øt qu·∫£ r√µ r√†ng n·∫øu th√†nh c√¥ng ho·∫∑c tr·∫£ l·ªùi l·ªãch s·ª± n·∫øu c√≥ l·ªói t·ª´ c√¥ng c·ª•.",
        tools=[get_weather],  # D√πng l·∫°i c√¥ng c·ª• ƒë√£ ƒë·ªãnh nghƒ©a
    )
    print(f"ƒê√£ t·∫°o agent '{weather_agent_gpt.name}' v·ªõi m√¥ h√¨nh '{MODEL_GPT_4O}'.")

    # InMemorySessionService l√† d·ªãch v·ª• l∆∞u tr·ªØ ƒë∆°n gi·∫£n, kh√¥ng b·ªÅn v·ªØng ‚Äì ph√π h·ª£p ƒë·ªÉ demo.
    session_service_gpt = InMemorySessionService()  # T·∫°o ri√™ng service cho agent n√†y

    # X√°c ƒë·ªãnh th√¥ng tin ƒë·ªãnh danh cho ng·ªØ c·∫£nh t∆∞∆°ng t√°c
    APP_NAME_GPT = "weather_tutorial_app_gpt"
    USER_ID_GPT = "user_1_gpt"
    SESSION_ID_GPT = "session_001_gpt"

    # T·∫°o session c·ª• th·ªÉ cho cu·ªôc tr√≤ chuy·ªán n√†y
    session_gpt = await session_service_gpt.create_session(
        app_name=APP_NAME_GPT,
        user_id=USER_ID_GPT,
        session_id=SESSION_ID_GPT
    )
    print(f"ƒê√£ t·∫°o session: App='{APP_NAME_GPT}', User='{USER_ID_GPT}', Session='{SESSION_ID_GPT}'")

    # T·∫°o runner cho agent n√†y
    runner_gpt = Runner(
        agent=weather_agent_gpt,
        app_name=APP_NAME_GPT,
        session_service=session_service_gpt
    )
    print(f"ƒê√£ t·∫°o runner cho agent '{runner_gpt.agent.name}'.")

    # --- Ki·ªÉm th·ª≠ agent GPT ---
    print("\n--- ƒêang ki·ªÉm tra agent GPT ---")
    await call_agent_async(query="Th·ªùi ti·∫øt ·ªü Tokyo nh∆∞ th·∫ø n√†o?",
                           runner=runner_gpt,
                           user_id=USER_ID_GPT,
                           session_id=SESSION_ID_GPT)
    
except Exception as e:
    print(f"‚ùå Kh√¥ng th·ªÉ t·∫°o ho·∫∑c ch·∫°y agent GPT '{MODEL_GPT_4O}'. Ki·ªÉm tra l·∫°i API Key v√† t√™n model. L·ªói: {e}")
```
**T·∫°o v√† ki·ªÉm tra agent s·ª≠ d·ª•ng m√¥ h√¨nh Claude Sonnet c·ªßa Anthropicss**
```
# --- Agent s·ª≠ d·ª•ng Claude Sonnet ---
weather_agent_claude = None  # Kh·ªüi t·∫°o gi√° tr·ªã None
runner_claude = None         # Kh·ªüi t·∫°o runner

try:
    weather_agent_claude = Agent(
        name="weather_agent_claude",
        # ƒêi·ªÉm kh√°c bi·ªát: s·ª≠ d·ª•ng LiteLLM ƒë·ªÉ wrap model Claude
        model=LiteLlm(model=MODEL_CLAUDE_SONNET),
        description="Cung c·∫•p th√¥ng tin th·ªùi ti·∫øt (s·ª≠ d·ª•ng Claude Sonnet).",
        instruction="B·∫°n l√† m·ªôt tr·ª£ l√Ω th·ªùi ti·∫øt th√¢n thi·ªán, ƒë∆∞·ª£c h·ªó tr·ª£ b·ªüi Claude Sonnet. "
                    "S·ª≠ d·ª•ng c√¥ng c·ª• 'get_weather' ƒë·ªÉ x·ª≠ l√Ω y√™u c·∫ßu th·ªùi ti·∫øt theo th√†nh ph·ªë. "
                    "Ph√¢n t√≠ch output d·∫°ng t·ª´ ƒëi·ªÉn t·ª´ tool (g·ªìm 'status', 'report' ho·∫∑c 'error_message'). "
                    "Tr√¨nh b√†y k·∫øt qu·∫£ n·∫øu th√†nh c√¥ng, ho·∫∑c b√°o l·ªói m·ªôt c√°ch l·ªãch s·ª± n·∫øu c√≥.",
        tools=[get_weather],  # D√πng l·∫°i tool ƒë√£ ƒë·ªãnh nghƒ©a
    )
    print(f"ƒê√£ t·∫°o agent '{weather_agent_claude.name}' v·ªõi model '{MODEL_CLAUDE_SONNET}'.")

    # InMemorySessionService l√† d·∫°ng l∆∞u tr·ªØ ƒë∆°n gi·∫£n, kh√¥ng b·ªÅn v·ªØng ‚Äì ph√π h·ª£p ƒë·ªÉ demo.
    session_service_claude = InMemorySessionService()  # T·∫°o ri√™ng cho agent Claude

    # X√°c ƒë·ªãnh th√¥ng tin ƒë·ªãnh danh cho ng·ªØ c·∫£nh t∆∞∆°ng t√°c
    APP_NAME_CLAUDE = "weather_tutorial_app_claude"
    USER_ID_CLAUDE = "user_1_claude"
    SESSION_ID_CLAUDE = "session_001_claude"

    # T·∫°o session cho cu·ªôc tr√≤ chuy·ªán n√†y
    session_claude = await session_service_claude.create_session(
        app_name=APP_NAME_CLAUDE,
        user_id=USER_ID_CLAUDE,
        session_id=SESSION_ID_CLAUDE
    )
    print(f"ƒê√£ t·∫°o session: App='{APP_NAME_CLAUDE}', User='{USER_ID_CLAUDE}', Session='{SESSION_ID_CLAUDE}'")

    # T·∫°o runner cho agent n√†y
    runner_claude = Runner(
        agent=weather_agent_claude,
        app_name=APP_NAME_CLAUDE,
        session_service=session_service_claude
    )
    print(f"ƒê√£ t·∫°o runner cho agent '{runner_claude.agent.name}'.")

    # --- Ki·ªÉm th·ª≠ Agent Claude ---
    print("\n--- ƒêang ki·ªÉm tra agent Claude ---")
    await call_agent_async(query="Weather in London please.",
                           runner=runner_claude,
                           user_id=USER_ID_CLAUDE,
                           session_id=SESSION_ID_CLAUDE)

except Exception as e:
    print(f"‚ùå Kh√¥ng th·ªÉ t·∫°o ho·∫∑c ch·∫°y Claude agent '{MODEL_CLAUDE_SONNET}'. Ki·ªÉm tra l·∫°i API Key v√† t√™n model. L·ªói: {e}")
```
## 3. Step 3: X√¢y d·ª±ng m·ªôt nh√≥m Agent - Ph√¢n quy·ªÅn cho L·ªùi ch√†o v√† T·∫°m bi·ªát

·ªû b∆∞·ªõc 1 v√† 2, ch√∫ng ta ƒë√£ x√¢y d·ª±ng v√† th·ª≠ nghi·ªám m·ªôt agent duy nh·∫•t t·∫≠p trung v√†o vi·ªác tra c·ª©u th·ªùi ti·∫øt. M·∫∑c d√π hi·ªáu qu·∫£ v·ªõi nhi·ªám v·ª• c·ª• th·ªÉ, nh∆∞ng trong c√°c ·ª©ng d·ª•ng th·ª±c t·∫ø, ng∆∞·ªùi d√πng c√≥ th·ªÉ y√™u c·∫ßu nhi·ªÅu d·∫°ng t∆∞∆°ng t√°c kh√°c nhau. Ch√∫ng ta c√≥ th·ªÉ ti·∫øp t·ª•c th√™m nhi·ªÅu c√¥ng c·ª• v√† h∆∞·ªõng d·∫´n ph·ª©c t·∫°p v√†o agent th·ªùi ti·∫øt ban ƒë·∫ßu, nh∆∞ng c√°ch l√†m n√†y s·∫Ω nhanh ch√≥ng tr·ªü n√™n kh√≥ qu·∫£n l√Ω v√† k√©m hi·ªáu qu·∫£.

M·ªôt c√°ch ti·∫øp c·∫≠n linh ho·∫°t h∆°n l√† x√¢y d·ª±ng m·ªôt Nh√≥m Agent (Agent Team).
1. T·∫°o nhi·ªÅu agent ri√™ng bi·ªát, m·ªói agent ph·ª•c v·ª• cho m·ªôt nƒÉng l·ª±c c·ª• th·ªÉ (v√≠ d·ª•: m·ªôt agent cho th·ªùi ti·∫øt, m·ªôt agent cho l·ªùi ch√†o, m·ªôt agent cho t√≠nh to√°n, v.v.)
2. Ch·ªâ ƒë·ªãnh m·ªôt agent g·ªëc (root) - c√≤n g·ªçi l√† orchestraor ƒë·ªÉ nh·∫≠n y√™u c·∫ßu ban ƒë·∫ßu t·ª´ ng∆∞·ªùi d√πng
3. Cho ph√©p agent g·ªëc ph√¢n quy·ªÅn (delegate) y√™u c·∫ßu ƒë·∫øn c√°c sub-agent ph√π h·ª£p d·ª±a tr√™n m·ª•c ƒë√≠ch c·ªßa ng∆∞·ªùi d√πng

‚ùì T·∫°i sao l·∫°i c·∫ßn x√¢y d·ª±ng m·ªôt Nh√≥m Agent?
- T√≠nh m√¥-ƒëun: D·ªÖ ph√°t tri·ªÉn, th·ª≠ nghi·ªám v√† b·∫£o tr√¨ t·ª´ng agent ri√™ng bi·ªát.
- T√≠nh chuy√™n bi·ªát: M·ªói agent c√≥ th·ªÉ ƒë∆∞·ª£c tinh ch·ªânh (h∆∞·ªõng d·∫´n, ch·ªçn model) ph√π h·ª£p v·ªõi nhi·ªám v·ª• c·ª• th·ªÉ.
- T√≠nh m·ªü r·ªông: D·ªÖ d√†ng th√™m ch·ª©c nƒÉng m·ªõi ch·ªâ b·∫±ng c√°ch th√™m agent m·ªõi.
- Hi·ªáu qu·∫£ chi ph√≠: C√≥ th·ªÉ s·ª≠ d·ª•ng model ƒë∆°n gi·∫£n/gi√° r·∫ª h∆°n cho c√°c t√°c v·ª• ƒë∆°n gi·∫£n (nh∆∞ l·ªùi ch√†o).

‚úÖ Trong b∆∞·ªõc n√†y, m√¨nh s·∫Ω:
1. ƒê·ªãnh nghƒ©a c√°c c√¥ng c·ª• ƒë∆°n gi·∫£n ƒë·ªÉ x·ª≠ l√Ω l·ªùi ch√†o (say_hello) v√† t·∫°m bi·ªát (say_goodbye).
2. T·∫°o 2 agent ph·ª• chuy√™n bi·ªát m·ªõi: greeting_agent v√† farewell_agent.
3. C·∫≠p nh·∫≠t agent th·ªùi ti·∫øt ch√≠nh th√†nh agent g·ªëc (weather_agent_v2).
4. C·∫•u h√¨nh agent g·ªëc v·ªõi danh s√°ch c√°c sub-agent ƒë·ªÉ h·ªó tr·ª£ ph√¢n quy·ªÅn t·ª± ƒë·ªông.
5. Th·ª≠ nghi·ªám lu·ªìng ph√¢n quy·ªÅn b·∫±ng c√°ch g·ª≠i c√°c lo·∫°i y√™u c·∫ßu kh√°c nhau cho agent g·ªëc.

**ƒê·ªãnh nghƒ©a c√°c Tool cho c√°c Agent ph·ª•**

Tr∆∞·ªõc ti√™n, ch√∫ng ta s·∫Ω t·∫°o c√°c h√†m Python ƒë∆°n gi·∫£n ƒë√≥ng vai tr√≤ l√† tool cho c√°c agent chuy√™n bi·ªát m·ªõi.
```
from typing import Optional 


def say_hello(name: Optional[str] = None) -> str:
    """Tr·∫£ v·ªÅ m·ªôt l·ªùi ch√†o ƒë∆°n gi·∫£n. N·∫øu c√≥ t√™n, l·ªùi ch√†o s·∫Ω bao g·ªìm t√™n.

    Args:
        name (str, optional): T√™n ng∆∞·ªùi c·∫ßn ch√†o. M·∫∑c ƒë·ªãnh s·∫Ω d√πng l·ªùi ch√†o chung n·∫øu kh√¥ng truy·ªÅn t√™n.

    Returns:
        str: C√¢u ch√†o th√¢n thi·ªán.
    """
    if name:
        greeting = f"Xin ch√†o, {name}!"
        print(f"--- Tool: say_hello ƒë∆∞·ª£c g·ªçi v·ªõi t√™n: {name} ---")
    else:
        greeting = "Xin ch√†o!"
        print(f"--- Tool: say_hello ƒë∆∞·ª£c g·ªçi m√† kh√¥ng c√≥ t√™n c·ª• th·ªÉ (gi√° tr·ªã name: {name}) ---")
    return greeting

def say_goodbye() -> str:
    """Tr·∫£ v·ªÅ m·ªôt c√¢u ch√†o t·∫°m bi·ªát ƒë∆°n gi·∫£n ƒë·ªÉ k·∫øt th√∫c cu·ªôc h·ªôi tho·∫°i."""
    print(f"--- Tool: say_goodbye ƒë∆∞·ª£c g·ªçi ---")
    return "T·∫°m bi·ªát! Ch√∫c b·∫°n m·ªôt ng√†y t·ªët l√†nh."
```
**ƒê·ªãnh nghƒ©a c√°c Sub-Agent (Ch√†o h·ªèi & T·∫°m bi·ªát)**

B√¢y gi·ªù, ta s·∫Ω t·∫°o c√°c agent chuy√™n tr√°ch cho t·ª´ng nhi·ªám v·ª• c·ª• th·ªÉ.

*L∆∞u √Ω:* C·∫ßn ch√∫ √Ω ƒë·∫øn ph·∫ßn m√¥ t·∫£ (description) v√¨ agent g·ªëc s·∫Ω d·ª±a v√†o ƒë√≥ ƒë·ªÉ quy·∫øt ƒë·ªãnh c√≥ n√™n ·ªßy quy·ªÅn cho c√¢u h·ªèi cho sub-agent hay kh√¥ng.

**N√™n:**
- Tr∆∞·ªùng description n√™n ng·∫Øn g·ªçn, r√µ r√†ng v√† th·ªÉ hi·ªán ƒë√∫ng kh·∫£ nƒÉng chuy√™n m√¥n c·ªßa sub-agent.
- Tr∆∞·ªùng instruction n√™n ƒë∆∞·ª£c vi·∫øt r√µ r√†ng, gi·ªõi h·∫°n ph·∫°m vi nhi·ªám v·ª• c·ªßa agent (v√≠ d·ª•: ‚ÄúNhi·ªám v·ª• duy nh·∫•t c·ªßa b·∫°n l√†‚Ä¶‚Äù).

**ƒê·ªãnh nghƒ©a Greeting Agent (Agent Ch√†o h·ªèi)**
```
greeting_agent = None
try:
    greeting_agent = Agent(
        model = MODEL_GEMINI_2_0_FLASH,  # D√πng model ƒë∆°n gi·∫£n v√¨ nhi·ªám v·ª• nh·∫π
        name="greeting_agent",
        instruction="B·∫°n l√† Greeting Agent. NHI·ªÜM V·ª§ DUY NH·∫§T c·ªßa b·∫°n l√† g·ª≠i l·ªùi ch√†o th√¢n thi·ªán ƒë·∫øn ng∆∞·ªùi d√πng. "
                    "H√£y d√πng c√¥ng c·ª• 'say_hello' ƒë·ªÉ t·∫°o l·ªùi ch√†o. "
                    "N·∫øu ng∆∞·ªùi d√πng cung c·∫•p t√™n, h√£y truy·ªÅn t√™n ƒë√≥ cho c√¥ng c·ª•. "
                    "Kh√¥ng th·ª±c hi·ªán b·∫•t k·ª≥ t√°c v·ª• n√†o kh√°c.",
        description="X·ª≠ l√Ω l·ªùi ch√†o ƒë∆°n gi·∫£n v√† ch√†o h·ªèi b·∫±ng c√¥ng c·ª• 'say_hello'.", # C·ª±c k·ª≥ quan tr·ªçng cho vi·ªác ph√¢n quy·ªÅn
        tools=[say_hello],
    )
    print(f"‚úÖ Agent '{greeting_agent.name}' ƒë√£ ƒë∆∞·ª£c t·∫°o v·ªõi model '{greeting_agent.model}'.")
except Exception as e:
    print(f"‚ùå Kh√¥ng th·ªÉ t·∫°o Greeting Agent. Ki·ªÉm tra API Key ({greeting_agent.model}). L·ªói: {e}")
```
**ƒê·ªãnh nghƒ©a Farewell Agent (Agent T·∫°m bi·ªát)**
```
farewell_agent = None
try:
    farewell_agent = Agent(
        model = MODEL_GEMINI_2_0_FLASH,  
        name="farewell_agent",
        instruction="B·∫°n l√† Farewell Agent. NHI·ªÜM V·ª§ DUY NH·∫§T c·ªßa b·∫°n l√† g·ª≠i l·ªùi t·∫°m bi·ªát l·ªãch s·ª±. "
                    "H√£y d√πng c√¥ng c·ª• 'say_goodbye' khi ng∆∞·ªùi d√πng th·ªÉ hi·ªán √Ω ƒë·ªãnh r·ªùi ƒëi ho·∫∑c k·∫øt th√∫c cu·ªôc h·ªôi tho·∫°i "
                    "(v√≠ d·ª• nh∆∞ d√πng c√°c t·ª´: 'bye', 'goodbye', 'c·∫£m ∆°n t·∫°m bi·ªát', 'h·∫πn g·∫∑p l·∫°i'). "
                    "Kh√¥ng th·ª±c hi·ªán b·∫•t k·ª≥ h√†nh ƒë·ªông n√†o kh√°c.",
        description="X·ª≠ l√Ω l·ªùi t·∫°m bi·ªát ƒë∆°n gi·∫£n b·∫±ng c√¥ng c·ª• 'say_goodbye'.", # Quan tr·ªçng ƒë·ªÉ agent g·ªëc hi·ªÉu ph√¢n c√¥ng
        tools=[say_goodbye],
    )
    print(f"‚úÖ Agent '{farewell_agent.name}' ƒë√£ ƒë∆∞·ª£c t·∫°o v·ªõi model '{farewell_agent.model}'.")
except Exception as e:
    print(f"‚ùå Kh√¥ng th·ªÉ t·∫°o Farewell Agent. Ki·ªÉm tra API Key ({farewell_agent.model}). L·ªói: {e}")
```
**ƒê·ªãnh nghƒ©a Agent g·ªëc (Weather Agent v2) v·ªõi c√°c Sub-Agent**

B√¢y gi·ªù, ch√∫ng ta s·∫Ω n√¢ng c·∫•p `weather_agent`. Nh·ªØng thay ƒë·ªïi ch√≠nh bao g·ªìm:
- Th√™m tham s·ªë `sub_agents`: Ch√∫ng ta truy·ªÅn v√†o m·ªôt danh s√°ch ch·ª©a c√°c instance c·ªßa `greeting_agent` v√† `farewell_agent` m√† ta ƒë√£ t·∫°o tr∆∞·ªõc ƒë√≥.
- C·∫≠p nh·∫≠t `instruction`: C·∫ßn h∆∞·ªõng d·∫´n r√µ r√†ng cho agent g·ªëc bi·∫øt v·ªÅ c√°c sub-agent v√† khi n√†o c·∫ßn ·ªßy nhi·ªám c√¥ng vi·ªác cho ch√∫ng.

üîë Kh√°i ni·ªám quan tr·ªçng: Automatic Delegation (·ª¶y quy·ªÅn t·ª± ƒë·ªông)
Khi cung c·∫•p danh s√°ch sub_agents, ADK s·∫Ω k√≠ch ho·∫°t t√≠nh nƒÉng t·ª± ƒë·ªông ·ªßy quy·ªÅn. Khi agent g·ªëc nh·∫≠n ƒë∆∞·ª£c c√¢u h·ªèi t·ª´ ng∆∞·ªùi d√πng, LLM s·∫Ω:
- Xem x√©t ch√≠nh n√≥ c√≥ th·ªÉ x·ª≠ l√Ω kh√¥ng
- ƒê√°nh gi√° ph·∫ßn m√¥ t·∫£ (description) c·ªßa m·ªói sub-agent
- V√† n·∫øu th·∫•y ph√π h·ª£p h∆°n, n√≥ s·∫Ω t·ª± ƒë·ªông chuy·ªÉn quy·ªÅn x·ª≠ l√Ω sang sub-agent th√¥ng qua m·ªôt h√†nh ƒë·ªông n·ªôi b·ªô ƒë·∫∑c bi·ªát

‚û°Ô∏è Sub-agent s·∫Ω x·ª≠ l√Ω y√™u c·∫ßu b·∫±ng m√¥ h√¨nh, h∆∞·ªõng d·∫´n v√† c√¥ng c·ª• ri√™ng c·ªßa n√≥.

```
root_agent = None
runner_root = None  

if greeting_agent and farewell_agent and 'get_weather' in globals():
    # S·ª≠ d·ª•ng m√¥ h√¨nh Gemini m·∫°nh ƒë·ªÉ ƒëi·ªÅu ph·ªëi
    root_agent_model = MODEL_GEMINI_2_0_FLASH

    weather_agent_team = Agent(
        name="weather_agent_v2",  # ƒê·∫∑t t√™n phi√™n b·∫£n m·ªõi
        model=root_agent_model,
        description="Agent ƒëi·ªÅu ph·ªëi ch√≠nh. X·ª≠ l√Ω y√™u c·∫ßu th·ªùi ti·∫øt v√† ·ªßy quy·ªÅn l·ªùi ch√†o/t·∫°m bi·ªát cho c√°c agent chuy√™n bi·ªát.",
        instruction="B·∫°n l√† Weather Agent ch√≠nh, ph·ª• tr√°ch ƒëi·ªÅu ph·ªëi m·ªôt nh√≥m agent. Nhi·ªám v·ª• ch√≠nh c·ªßa b·∫°n l√† cung c·∫•p th√¥ng tin th·ªùi ti·∫øt. "
                    "Ch·ªâ s·ª≠ d·ª•ng c√¥ng c·ª• 'get_weather' cho c√°c y√™u c·∫ßu li√™n quan ƒë·∫øn th·ªùi ti·∫øt (v√≠ d·ª•: 'th·ªùi ti·∫øt ·ªü London'). "
                    "B·∫°n c√≥ c√°c agent chuy√™n bi·ªát nh∆∞ sau: "
                    "1. 'greeting_agent': X·ª≠ l√Ω l·ªùi ch√†o ƒë∆°n gi·∫£n nh∆∞ 'Hi', 'Hello'. H√£y ·ªßy quy·ªÅn cho n√≥ khi g·∫∑p c√°c t√¨nh hu·ªëng n√†y. "
                    "2. 'farewell_agent': X·ª≠ l√Ω l·ªùi t·∫°m bi·ªát ƒë∆°n gi·∫£n nh∆∞ 'Bye', 'See you'. H√£y ·ªßy quy·ªÅn cho n√≥ khi g·∫∑p c√°c t√¨nh hu·ªëng n√†y. "
                    "Ph√¢n t√≠ch c√¢u h·ªèi ng∆∞·ªùi d√πng. N·∫øu l√† l·ªùi ch√†o, h√£y ·ªßy quy·ªÅn cho 'greeting_agent'. N·∫øu l√† l·ªùi t·∫°m bi·ªát, h√£y ·ªßy quy·ªÅn cho 'farewell_agent'. "
                    "N·∫øu l√† y√™u c·∫ßu th·ªùi ti·∫øt, b·∫°n t·ª± x·ª≠ l√Ω b·∫±ng 'get_weather'. "
                    "V·ªõi c√°c tr∆∞·ªùng h·ª£p kh√°c, h√£y ph·∫£n h·ªìi ph√π h·ª£p ho·∫∑c th√¥ng b√°o r·∫±ng b·∫°n kh√¥ng th·ªÉ x·ª≠ l√Ω.",
        tools=[get_weather],  # Agent g·ªëc v·∫´n c·∫ßn tool th·ªùi ti·∫øt ƒë·ªÉ x·ª≠ l√Ω
        sub_agents=[greeting_agent, farewell_agent]  
    )
    print(f"‚úÖ ƒê√£ t·∫°o Root Agent '{weather_agent_team.name}' s·ª≠ d·ª•ng m√¥ h√¨nh '{root_agent_model}' v·ªõi c√°c sub-agent: {[sa.name for sa in weather_agent_team.sub_agents]}")
else:
    print("‚ùå Kh√¥ng th·ªÉ t·∫°o root agent v√¨ thi·∫øu sub-agent ho·∫∑c h√†m 'get_weather'.")
    if not greeting_agent: print(" - Thi·∫øu Greeting Agent.")
    if not farewell_agent: print(" - Thi·∫øu Farewell Agent.")
    if 'get_weather' not in globals(): print(" - Thi·∫øu h√†m get_weather.")
```

**T∆∞∆°ng t√°c v·ªõi nh√≥m Agent**

Ti·∫øp theo ta s·∫Ω:
1. ƒê·ªãnh nghƒ©a m·ªôt h√†m async t√™n l√† `run_team_conversation`.
2. Trong h√†m n√†y:
   - T·∫°o m·ªôt InMemorySessionService m·ªõi d√†nh ri√™ng cho b√†i test n√†y.
   - T·∫°o m·ªôt session ri√™ng bi·ªát v·ªõi ID l√† "session_001_agent_team" ƒë·ªÉ l·ªãch s·ª≠ h·ªôi tho·∫°i kh√¥ng b·ªã tr·ªôn v·ªõi c√°c b∆∞·ªõc tr∆∞·ªõc.
3. T·∫°o m·ªôt Runner c·∫•u h√¨nh ƒë·ªÉ s·ª≠ d·ª•ng weather_agent_team (agent g·ªëc) v√† session service v·ª´a t·∫°o.
4. G·ª≠i 3 truy v·∫•n kh√°c nhau (l·ªùi ch√†o, h·ªèi th·ªùi ti·∫øt, l·ªùi t·∫°m bi·ªát) t·ªõi runner n√†y b·∫±ng c√°ch s·ª≠ d·ª•ng h√†m call_agent_async ƒë√£ ƒë·ªãnh nghƒ©a ·ªü c√°c b∆∞·ªõc tr∆∞·ªõc.

K·ª≥ v·ªçng ho·∫°t ƒë·ªông:

| C√¢u h·ªèi ng∆∞·ªùi d√πng                 | Ai x·ª≠ l√Ω?                  | Tool ƒë∆∞·ª£c g·ªçi |
| ---------------------------------- | -------------------------- | ------------- |
| `Hello there!`                     | `greeting_agent`           | `say_hello`   |
| `What is the weather in New York?` | `weather_agent_team` (g·ªëc) | `get_weather` |
| `Thanks, bye!`                     | `farewell_agent`           | `say_goodbye` |

**K·∫øt qu·∫£ th·ª±c thi**
<p align="center">
![K·∫øt qu·∫£ th·ª±c thi](image.png)
</p>

---

<p align="center">
**V√µ Nh·∫•t Ph∆∞∆°ng** ho√†n th√†nh‚ú®‚ú®‚ú®
</p>

